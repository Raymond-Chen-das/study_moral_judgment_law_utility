# 第2章 資料處理

## 2.2 資料清理

### 清理流程

本研究聚焦於「守法vs.效益」的道德兩難情境，因此需要篩選符合此條件的場景，並處理資料品質問題。

### 清理步驟摘要

| 步驟 | 行數 | 刪除/過濾 | 保留比例 |
|------|------|-----------|----------|
| 原始資料 | 11,286,141 | - | 100.00% |
| 刪除關鍵變數缺失 | 11,244,500 | 41,641 | 99.63% |
| 刪除異常值 | 8,490,899 | 2,753,601 | 75.23% |
| 篩選守法vs.效益情境 | 594,175 | 7,896,724 | 5.26% |
| 檢查場景完整性 | 377,592 | 216,583 | 3.35% |
| 合併文化圈分類 | 377,592 | - | 3.35% |

### 各步驟說明

#### Step 1: 刪除關鍵變數缺失

關鍵變數包括：`Saved`、`ScenarioType`、`UserCountry3`、`ResponseID`。這些變數對於分析至關重要，缺失則無法進行後續分析。

- **刪除**: 41,641 行 (0.37%)
- **剩餘**: 11,244,500 行

#### Step 2: 刪除異常值

檢查以下變數的異常值：

- `Review_age`: 年齡範圍 [18, 75]
- `Review_political`: 政治立場 [0, 1]
- `Review_religious`: 宗教程度 [0, 1]

**處理策略**: 直接刪除超出合理範圍的資料，避免填補可能引入的偏誤。

- **刪除**: 2,753,601 行 (24.49%)
- **剩餘**: 8,490,899 行

#### Step 3: 篩選法律與效益相關場景

本步驟確保留下的資料具備分析「守法 vs. 效益」所需的變數結構，但尚未區分是否構成道德兩難。需同時滿足以下條件：

1. **ScenarioType = 'Utilitarian'**：場景設計涉及人數差異（而非性別、物種等單純比較）。
2. **CrossingSignal ∈ {1, 2}**：場景包含交通號誌變數（1=綠燈/守法，2=紅燈/違法）。
3. **DiffNumberOFCharacters > 0**：兩側人數確實有差異。

**篩選邏輯修正說明**：
在此階段，我們保留了所有包含「法律」與「人數」變數的場景。這包含兩種情況：

- **一致情境 (No Conflict)**：守法側也是多數側（例如：綠燈處有5人）。此類資料通常作為對照組，測試受試者是否理性。
- **衝突情境 (Conflict)**：守法側是少數側（例如：綠燈處僅1人）。這才是真正的道德兩難。

真正的「衝突」標記與篩選，將留待 **特徵工程 (Step 03)** 階段透過邏輯運算（`lawful_vs_majority_conflict`）進行標註。

- **保留**: 594,175 行 (7.00%)
- **過濾**: 7,896,724 行

#### Step 4: 檢查場景完整性

每個場景（`ResponseID`）應有2行資料，代表兩個可能的結果。刪除只有1行的不完整場景。

- **刪除**: 216,583 行不完整場景 (36.45%)
- **剩餘**: 377,592 行
- **完整場景數**: 188,796

#### 實際範例

場景： ResponseID 相同的兩行
第1行：CrossingSignal = 1（綠燈合法）、Barrier = 0（行人）、NumberOfCharacters = 3
第2行：CrossingSignal = 2（紅燈違法）、Barrier = 0（行人）、NumberOfCharacters = 5

解讀：車子面臨「3個合法過馬路的行人 vs. 5個違法過馬路的行人」的道德困境
⚠️ 資料篩選時的注意事項
如果要聚焦於「守法 vs. 效益」衝突，需要：
python# 篩選條件（概念示意）
conflict_scenarios = survey_data[
    (survey_data['ScenarioType'] == 'Utilitarian') &  # 效益主義場景
    (survey_data['CrossingSignal'].isin([1, 2])) &    # 有守法/違法差異
    (survey_data['DiffNumberOFCharacters'] > 0)        # 有人數差異
]
但這樣篩選會得到「單側」資料，還需要配對 ResponseID 來確認另一側的狀況，才能確定這是一個「守法少數 vs. 違法多數」的衝突場景。

#### Step 5: 合併文化圈分類

將 `country_cluster_map.csv` 的文化圈資訊合併到主資料，便於後續跨文化比較分析。

**文化圈分佈**:

- Unclassified (未分類小國): 476 行 (0.1%)
- Western: 278,830 行 (73.8%)
- Eastern: 29,748 行 (7.9%)
- Southern: 68,538 行 (18.2%)

### 最終結果

- **原始資料**: 11,286,141 行
- **清理後**: 377,592 行
- **保留比例**: 3.35%

清理後的資料聚焦於「守法vs.效益」衝突情境，可進行後續的描述性分析、統計推論與預測建模。
