## 5.2 機器學習驗證

**分析時間**: 2025-11-24 00:10:10

### 研究目的

以 XGBoost 機器學習模型驗證第4章統計推論的發現，
並透過 SHAP（SHapley Additive exPlanations）可解釋性分析
比較特徵重要性排序與預測能力的上限。

---

### 資料與特徵

**樣本配置**：

- 訓練樣本數: 74,847 筆
- 測試樣本數: 18,715 筆
- 特徵數: 11 個
- 目標變數分佈: chose_lawful=1 佔 45.1%（資料略不平衡）

**特徵分類**：

**場景結構特徵**（3個）：

- `DiffNumberOFCharacters` — 兩側人數差異（連續）
- `PedPed` — 是否為行人vs.行人（二元）
- `lawful_requires_intervention` — 守法方是否需介入（二元）

**個人特徵**（3個）：

- `Review_age` — 受試者年齡（連續）
- `Review_political` — 政治傾向 0-1（連續）
- `Review_religious` — 宗教虔誠度 0-1（連續）

**文化圈**（3個虛擬變數）：

- `Cluster_Western` — 西方文化圈
- `Cluster_Eastern` — 東方文化圈
- `Cluster_Southern` — 南方文化圈

**國家層級特徵**（2個）：

- `country_law_preference` — 該國的守法偏好
- `country_utilitarian` — 該國的效益主義傾向

---

### 模型性能

| 指標 | 測試集 | 5-fold CV (Mean ± SD) | 解讀 |
|------|--------|----------------------|------|
| **Accuracy** | 0.6059 | 0.6099 ± 0.0026 | 整體準確率 60.6% |
| **Precision** | 0.5869 | 0.6048 ± 0.0028 | 預測守法的精確度 |
| **Recall** | 0.4482 | 0.4450 ± 0.0066 | 實際守法的召回率 |
| **F1 Score** | 0.5083 | 0.5069 ± 0.0050 | 精確與召回的調和平均 |
| **ROC-AUC** | 0.6382 | 0.6383 ± 0.0009 | 分類能力綜合指標 |

**性能評估**：

- ROC-AUC = 0.6382，略優於隨機猜測（0.5），但仍屬中等預測能力
- 交叉驗證 SD 極小（0.0009），顯示結果高度穩定，非抽樣誤差
- Precision (0.5869) > Recall (0.4482)，顯示模型傾向保守預測

**模型預測傾向分析**：

Precision 明顯高於 Recall，反映模型在不平衡資料上的保守策略：

- 當預測為「選擇守法」時，有 58.7% 機率正確
- 但實際選擇守法的場景中，僅 44.8% 被模型識別

這種不平衡源於資料本身（chose_lawful=1 僅佔 45.1%），
模型傾向預測多數類別（效益選擇），導致守法選擇的召回率偏低。

---

### SHAP 特徵重要性

**方向說明**：

- **↑守法**：該特徵增加時，傾向選擇守法方（chose_lawful=1）
- **↓效益**：該特徵增加時，傾向選擇效益方（拯救多數）

（基於平均 SHAP 值的正負號判定）

| 排序 | 特徵 | SHAP 重要性 | 佔比 | 影響方向 |
|------|------|------------|------|----------|
| 1 | DiffNumberOFCharacters | 0.3650 | 38.96% | ↑守法 |
| 2 | lawful_requires_intervention | 0.1351 | 14.42% | ↓效益 |
| 3 | country_utilitarian | 0.0956 | 10.21% | ↓效益 |
| 4 | country_law_preference | 0.0858 | 9.16% | ↑守法 |
| 5 | Review_religious | 0.0803 | 8.57% | ↑守法 |
| 6 | Review_political | 0.0787 | 8.40% | ↓效益 |
| 7 | Review_age | 0.0771 | 8.23% | ↓效益 |
| 8 | Cluster_Eastern | 0.0097 | 1.04% | ↓效益 |
| 9 | Cluster_Western | 0.0062 | 0.66% | ↑守法 |
| 10 | Cluster_Southern | 0.0034 | 0.36% | ↓效益 |
| 11 | PedPed | 0.0000 | 0.00% | - |

**重要發現**：

1. **場景特徵主導**：前2名均為場景結構，合計佔 53.4% 重要性
2. **個人特徵微弱**：Review_age/political/religious 合計僅 25.2%
3. **文化圈幾乎無影響**：三個 Cluster 變數合計僅 2.1%

---

### 與第4章的比較

**方法學驗證**：

| 面向 | 第4章（邏輯迴歸） | 第5章（XGBoost + SHAP） | 一致性 |
|------|------------------|------------------------|--------|
| 模型類型 | 線性迴歸 | 非線性樹狀模型 | - |
| 解釋力指標 | Pseudo R² = 0.0004 | ROC-AUC = 0.6382 | ✓ 均有限 |
| 最重要變數 | 場景結構 | DiffNumberOFCharacters (38.96%) | ✓ 一致 |
| 個人特徵 | 效應微弱（OR ≈ 1.0） | SHAP < 0.08 | ✓ 一致 |
| 文化圈 | 不顯著（𝑝 = 0.530） | SHAP < 0.01 | ✓ 一致 |
| 理論結論 | 支持情境主義 | 支持情境主義 | ✓ 一致 |

**交叉驗證結論**：

兩種截然不同的建模方法（線性 vs. 非線性）得出高度一致的結論，
強化研究發現的穩健性（robustness）：

- 個人與文化因素對道德選擇的預測能力極為有限
- 即使使用能捕捉複雜交互作用的機器學習模型，
  解釋力仍無法顯著提升（AUC 僅 0.64）

---

### 關鍵發現

#### 1. 最重要特徵：人數差異（DiffNumberOFCharacters）

**SHAP 重要性 = 0.3650**，佔總貢獻 38.96%

**實質意涵**：

- 兩側人數差異是最強預測因子（遠超其他特徵）
- 驗證效益主義（utilitarianism）的核心影響力
- 但單一特徵仍無法主導決策（佔比 < 40%）

---

#### 2. 預測能力上限：ROC-AUC = 0.6382

**統計意義**：

- 略優於隨機猜測（0.5），但屬中等偏低
- 即使納入 11 個理論相關變數，模型仍無法有效預測
- 顯示道德選擇受未觀測因素（情境細節、當下情緒）主導

**與隨機對照**：

- 若完全隨機猜測：AUC = 0.50（基準線）
- 若完美預測：AUC = 1.00
- 本研究模型：AUC = 0.64（僅改善 14 個百分點）

---

#### 3. 驗證情境主義假設

**理論背景**：
情境主義（situationism, Doris 2002; Harman 1999）主張，
道德行為主要由當下情境決定，而非穩定的品格特質或文化背景。

**本研究證據**：

1. **場景特徵 >> 個人特質**
   - 場景結構（DiffNumberOFCharacters + lawful_requires_intervention）：53.4%
   - 個人特徵（age + political + religious）：25.2%
   - 文化圈（Western + Eastern + Southern）：2.1%

2. **非線性模型也無法突破**
   - XGBoost 可捕捉複雜交互作用（如「年輕且進步」的組合效應）
   - 但 ROC-AUC 仍僅 0.6382，顯示個人/文化交互作用也微弱

3. **與第4章線性模型一致**
   - 邏輯迴歸（假設線性）：Pseudo R² = 0.0004
   - XGBoost（允許非線性）：ROC-AUC = 0.6382
   - 兩者皆支持情境主義

**理論意涵**：

即使在控制所有理論相關變數（個人、文化、場景）後，
仍有大量變異無法解釋。這符合情境主義預測：

- 道德判斷受「當下情境細節」主導（如圖像呈現方式、情緒狀態）
- 個人特質（如年齡、宗教）僅在特定情境下顯現微弱效應
- 文化差異在道德兩難中幾乎消失（全球人類共享核心道德直覺）

---

### 研究限制

1. **類別不平衡**：chose_lawful=1 僅佔 45.1%，
   可能導致模型偏向預測多數類別（效益選擇）

2. **SHAP 假設**：SHAP 值基於特徵獨立性假設，
   若變數間存在強共線性（如 country_utilitarian 與 Cluster），
   重要性分配可能失真

3. **樣本代表性**：僅分析「守法 vs. 多數衝突」場景，
   無法推論至其他道德兩難類型（如 trolley problem 的 switch vs. push 變體）

---

### 視覺化結果

完整互動式圖表請見：

- [ROC 曲線與 AUC 分析](../outputs/figures/chapter5/roc_curve.html)
- [混淆矩陣（預測 vs. 實際）](../outputs/figures/chapter5/confusion_matrix.html)
- [SHAP 特徵重要性圖](../outputs/figures/chapter5/shap_importance.html)
